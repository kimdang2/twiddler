<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <div class = "container">
      <h1 class ="title"> Twiddler</h1>
      <button class='btn-tweet'> (1) New Tweet</button>
      <div class="newsfeed"></div>
    </div>

    <script>
      $(document).ready(function(user){
        //displays a new tweet with message, user, and time each traversal

        var displayTweets = function(user) {
          var index = 6;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<div class=tweet></div>');
            var $user = $('<div class=user></div>');
            var $message = $('<div class=message></div>');
            var $dateTime = $('<span class=dateTime></span>');
            user = tweet.user || user;
            $tweet.appendTo(".newsfeed")
            $user.html('<a href="#' + user + '">@'
              + user + '</a> '+ ' ~ ' + moment(tweet.created_at).fromNow()).prependTo($tweet);
            $message.html('<i>"</i>'+ tweet.message+ '<i>"</i>').appendTo($tweet);

            index -= 1;
          }
        }
        displayTweets();
        //generateOneRandomTweet().show(5000);

        // When clicked, button will display one new tweet
        var button = function() {
          $(".btn-tweet").click(function (){
          generateOneRandomTweet();
          });
        }
        button();

        // generates one new random tweet
        var generateOneRandomTweet = function(){
          var index = Math.floor(Math.random() * streams.home.length);
          var counter = 0;
          while(counter >= 0){
            var tweet = streams.home[index]; // array of tweets
            var $tweet = $('<div class=tweet></div>');
            var $user = $('<div class=user></div>');
            var $message = $('<div class=message></div>');

            $tweet.prependTo('.newsfeed')
            $user.html('<a href="#' + tweet.user + '">@' + tweet.user + '</a> '+ ' ~ ' + moment(tweet.created_at).fromNow()).prependTo($tweet);
            $message.html('<i>"</i>'+ tweet.message+ '<i>"</i>').appendTo($tweet);

            counter -= 1;
          }
          clearTimeline();
        }

        // When username name is clicked, displays user's timeline
        var clearTimeline = function() {
            $("a").on('click', function(event) {
              event.preventDefault();
              var username = this.getAttribute('href').slice(1);
              $('.container').html('');
              var $timeline = $('<div class=newsfeed><h2>'+ username + '\'s Timeline</h2></div>').appendTo('.container');
              usersTweets(username);
          });
        }
        clearTimeline();

        var usersTweets = function(username) {
          var index = 8;
          while(index >= 0){
            var tweet = streams.home[index]; // array of tweets
            var $tweet = $('<div class=tweet></div>');
            var $user = $('<div class=user></div>');
            var $message = $('<div class=message></div>');
            var $dateTime = $('<span class=dateTime></span>');

            $tweet.appendTo(".newsfeed")
            $user.html('<a href="#' + username + '">@'
              + username + '</a> '+ ' ~ ' + moment(tweet.created_at).fromNow()).prependTo($tweet);
            $message.html('<i>"</i>'+ tweet.message+ '<i>"</i>').appendTo($tweet);

            index -= 1;
          }
        }

      });//end of document.ready function
    </script>


  </body>
</html>
